\doxysection{node\+\_\+modules/mquery Directory Reference}
\hypertarget{dir_c059e4976cbbd388ec044cee85c8f45c}{}\label{dir_c059e4976cbbd388ec044cee85c8f45c}\index{node\_modules/mquery Directory Reference@{node\_modules/mquery Directory Reference}}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_61355c74fd6cc4ee56e9313fb96c0dd4}{lib}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
{\ttfamily mquery} is a fluent mongodb query builder designed to run in multiple environments.

\href{https://travis-ci.org/aheckmann/mquery}{\texttt{ }} \href{http://badge.fury.io/js/mquery}{\texttt{ }}

\href{https://www.npmjs.com/package/mquery}{\texttt{ }}\hypertarget{README.md_autotoc_md2622}{}\doxysubsection{\texorpdfstring{Features}{Features}}\label{README.md_autotoc_md2622}

\begin{DoxyItemize}
\item fluent query builder api
\item custom base query support
\item Mongo\+DB 2.\+4 geo\+JSON support
\item method + option combinations validation
\item node.\+js driver compatibility
\item environment detection
\item \href{https://github.com/visionmedia/debug}{\texttt{ debug}} support
\item separated collection implementations for maximum flexibility
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2623}{}\doxysubsection{\texorpdfstring{Use}{Use}}\label{README.md_autotoc_md2623}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ mongo\ =\ require('mongodb');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ client\ =\ new\ mongo.MongoClient(uri);}
\DoxyCodeLine{await\ client.connect();}
\DoxyCodeLine{//\ get\ a\ collection}
\DoxyCodeLine{const\ collection\ =\ client.collection('artists');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ pass\ it\ to\ the\ constructor}
\DoxyCodeLine{await\ mquery(collection).find(\{...\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or\ pass\ it\ to\ the\ collection\ method}
\DoxyCodeLine{const\ docs\ =\ await\ mquery().find(\{...\}).collection(collection);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or\ better\ yet,\ create\ a\ custom\ query\ constructor\ that\ has\ it\ always\ set}
\DoxyCodeLine{const\ Artist\ =\ mquery(collection).toConstructor();}
\DoxyCodeLine{const\ docs\ =\ await\ Artist().find(...).where(...);}

\end{DoxyCode}


{\ttfamily mquery} requires a collection object to work with. In the example above we just pass the collection object created using the official \href{https://github.com/mongodb/node-mongodb-native}{\texttt{ Mongo\+DB driver}}.\hypertarget{README.md_autotoc_md2624}{}\doxysubsection{\texorpdfstring{Fluent API}{Fluent API}}\label{README.md_autotoc_md2624}

\begin{DoxyItemize}
\item mquery
\begin{DoxyItemize}
\item Features
\item Use
\item Fluent API
\item Helpers
\begin{DoxyItemize}
\item find()
\item find\+One()
\item count()
\item find\+One\+And\+Update()
\begin{DoxyItemize}
\item find\+One\+And\+Update() options
\end{DoxyItemize}
\item find\+One\+And\+Remove()
\begin{DoxyItemize}
\item find\+One\+And\+Remove() options
\end{DoxyItemize}
\item distinct()
\item exec()
\item stream()
\item all()
\item and()
\item box()
\item circle()
\item elem\+Match()
\item equals()
\item exists()
\item geometry()
\item gt()
\item gte()
\item in()
\item intersects()
\item lt()
\item lte()
\item max\+Distance()
\item mod()
\item ne()
\item nin()
\item nor()
\item near()
\begin{DoxyItemize}
\item Example
\end{DoxyItemize}
\item or()
\item polygon()
\item regex()
\item select()
\begin{DoxyItemize}
\item String syntax
\end{DoxyItemize}
\item selected()
\item selected\+Inclusively()
\item selected\+Exclusively()
\item size()
\item slice()
\item within()
\item where()
\item \$where()
\item batch\+Size()
\item collation()
\item comment()
\item hint()
\item j()
\item limit()
\item max\+Time()
\item skip()
\item sort()
\item read()
\begin{DoxyItemize}
\item Preferences\+:
\item Preference Tags\+:
\end{DoxyItemize}
\item read\+Concern()
\begin{DoxyItemize}
\item Read Concern Level\+:
\end{DoxyItemize}
\item write\+Concern()
\begin{DoxyItemize}
\item Write Concern\+:
\end{DoxyItemize}
\item slave\+Ok()
\item tailable()
\item wtimeout()
\end{DoxyItemize}
\item Helpers
\begin{DoxyItemize}
\item collection()
\item then()
\item merge(object)
\item set\+Options(options)
\begin{DoxyItemize}
\item set\+Options() options
\end{DoxyItemize}
\item set\+Trace\+Function(func)
\item mquery.set\+Global\+Trace\+Function(func)
\item mquery.can\+Merge(conditions)
\end{DoxyItemize}
\item mquery.use\$geo\+Within
\item Custom Base Queries
\item Validation
\item Debug support
\item General compatibility
\begin{DoxyItemize}
\item Object\+Ids
\item Read Preferences
\end{DoxyItemize}
\item Future goals
\item Installation
\item \doxylink{README.md_license}{License}
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2625}{}\doxysubsection{\texorpdfstring{Helpers}{Helpers}}\label{README.md_autotoc_md2625}

\begin{DoxyItemize}
\item collection
\item then
\item merge
\item set\+Options
\item set\+Trace\+Function
\item mquery.set\+Global\+Trace\+Function
\item mquery.can\+Merge
\item mquery.use\$geo\+Within
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2626}{}\doxysubsubsection{\texorpdfstring{find()}{find()}}\label{README.md_autotoc_md2626}
Declares this query a {\itshape find} query. Optionally pass a match clause.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().find()}
\DoxyCodeLine{mquery().find(match)}
\DoxyCodeLine{await\ mquery().find()}
\DoxyCodeLine{const\ docs\ =\ await\ mquery().find(match);}
\DoxyCodeLine{assert(Array.isArray(docs));}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2627}{}\doxysubsubsection{\texorpdfstring{find\+One()}{find\+One()}}\label{README.md_autotoc_md2627}
Declares this query a {\itshape find\+One} query. Optionally pass a match clause.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().findOne()}
\DoxyCodeLine{mquery().findOne(match)}
\DoxyCodeLine{await\ mquery().findOne()}
\DoxyCodeLine{const\ doc\ =\ await\ mquery().findOne(match);}
\DoxyCodeLine{if\ (doc)\ \{}
\DoxyCodeLine{\ \ //\ the\ document\ may\ not\ be\ found}
\DoxyCodeLine{\ \ console.log(doc);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2628}{}\doxysubsubsection{\texorpdfstring{count()}{count()}}\label{README.md_autotoc_md2628}
Declares this query a {\itshape count} query. Optionally pass a match clause.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().count()}
\DoxyCodeLine{mquery().count(match)}
\DoxyCodeLine{await\ mquery().count()}
\DoxyCodeLine{const\ number\ =\ await\ mquery().count(match);}
\DoxyCodeLine{console.log('we\ found\ \%d\ matching\ documents',\ number);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2629}{}\doxysubsubsection{\texorpdfstring{find\+One\+And\+Update()}{find\+One\+And\+Update()}}\label{README.md_autotoc_md2629}
Declares this query a {\itshape find\+And\+Modify} with update query. Optionally pass a match clause, update document, options.

When executed, the first matching document (if found) is modified according to the update document and passed back.\hypertarget{README.md_autotoc_md2630}{}\doxysubsubsubsection{\texorpdfstring{find\+One\+And\+Update() options}{find\+One\+And\+Update() options}}\label{README.md_autotoc_md2630}
Options are passed to the {\ttfamily set\+Options()} method.


\begin{DoxyItemize}
\item {\ttfamily return\+Document}\+: string -\/ `\textquotesingle{}after'{\ttfamily to return the modified document rather than the original. defaults to}\textquotesingle{}before\textquotesingle{}{\ttfamily  -\/}upsert{\ttfamily \+: boolean -\/ creates the object if it doesn\textquotesingle{}t exist. defaults to false -\/}sort\`{}\+: if multiple docs are found by the match condition, sets the sort order to choose which doc to update
\end{DoxyItemize}


\begin{DoxyCode}{0}
\DoxyCodeLine{query.findOneAndUpdate()}
\DoxyCodeLine{query.findOneAndUpdate(updateDocument)}
\DoxyCodeLine{query.findOneAndUpdate(match,\ updateDocument)}
\DoxyCodeLine{query.findOneAndUpdate(match,\ updateDocument,\ options)}
\DoxyCodeLine{}
\DoxyCodeLine{//\ the\ following\ all\ execute\ the\ command}
\DoxyCodeLine{await\ query.findOneAndUpdate()}
\DoxyCodeLine{await\ query.findOneAndUpdate(updateDocument)}
\DoxyCodeLine{await\ query.findOneAndUpdate(match,\ updateDocument)}
\DoxyCodeLine{const\ doc\ =\ await\ await\ query.findOneAndUpdate(match,\ updateDocument,\ options);}
\DoxyCodeLine{if\ (doc)\ \{}
\DoxyCodeLine{\ \ //\ the\ document\ may\ not\ be\ found}
\DoxyCodeLine{\ \ console.log(doc);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2631}{}\doxysubsubsection{\texorpdfstring{find\+One\+And\+Remove()}{find\+One\+And\+Remove()}}\label{README.md_autotoc_md2631}
Declares this query a {\itshape find\+And\+Modify} with remove query. Alias of find\+One\+And\+Delete. Optionally pass a match clause, options.

When executed, the first matching document (if found) is modified according to the update document, removed from the collection and passed as a result.\hypertarget{README.md_autotoc_md2632}{}\doxysubsubsubsection{\texorpdfstring{find\+One\+And\+Remove() options}{find\+One\+And\+Remove() options}}\label{README.md_autotoc_md2632}
Options are passed to the {\ttfamily set\+Options()} method.


\begin{DoxyItemize}
\item {\ttfamily sort}\+: if multiple docs are found by the condition, sets the sort order to choose which doc to modify and remove
\end{DoxyItemize}


\begin{DoxyCode}{0}
\DoxyCodeLine{A.where().findOneAndDelete()}
\DoxyCodeLine{A.where().findOneAndRemove()}
\DoxyCodeLine{A.where().findOneAndRemove(match)}
\DoxyCodeLine{A.where().findOneAndRemove(match,\ options)}
\DoxyCodeLine{}
\DoxyCodeLine{//\ the\ following\ all\ execute\ the\ command}
\DoxyCodeLine{await\ A.where().findOneAndRemove()}
\DoxyCodeLine{await\ A.where().findOneAndRemove(match)}
\DoxyCodeLine{const\ doc\ =\ await\ A.where().findOneAndRemove(match,\ options);}
\DoxyCodeLine{if\ (doc)\ \{}
\DoxyCodeLine{\ \ //\ the\ document\ may\ not\ be\ found}
\DoxyCodeLine{\ \ console.log(doc);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2633}{}\doxysubsubsection{\texorpdfstring{distinct()}{distinct()}}\label{README.md_autotoc_md2633}
Declares this query a {\itshape distinct} query. Optionally pass the distinct field, a match clause.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().distinct()}
\DoxyCodeLine{mquery().distinct(match)}
\DoxyCodeLine{mquery().distinct(match,\ field)}
\DoxyCodeLine{mquery().distinct(field)}
\DoxyCodeLine{}
\DoxyCodeLine{//\ the\ following\ all\ execute\ the\ command}
\DoxyCodeLine{await\ mquery().distinct()}
\DoxyCodeLine{await\ mquery().distinct(field)}
\DoxyCodeLine{await\ mquery().distinct(match)}
\DoxyCodeLine{const\ result\ =\ await\ mquery().distinct(match,\ field);}
\DoxyCodeLine{console.log(result);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2634}{}\doxysubsubsection{\texorpdfstring{exec()}{exec()}}\label{README.md_autotoc_md2634}
Executes the query.


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ docs\ =\ await\ mquery().findOne().where('route').intersects(polygon).exec()}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2635}{}\doxysubsubsection{\texorpdfstring{stream()}{stream()}}\label{README.md_autotoc_md2635}
Executes the query and returns a stream.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ stream\ =\ mquery().find().stream(options);}
\DoxyCodeLine{stream.on('data',\ cb);}
\DoxyCodeLine{stream.on('close',\ fn);}

\end{DoxyCode}


Note\+: this only works with {\ttfamily find()} operations.

Note\+: returns the stream object directly from the node-\/mongodb-\/native driver. (currently streams1 type stream). Any options will be passed along to the \href{http://mongodb.github.io/node-mongodb-native/api-generated/cursor.html\#stream}{\texttt{ driver method}}.

\DoxyHorRuler{0}
\hypertarget{README.md_autotoc_md2637}{}\doxysubsubsection{\texorpdfstring{all()}{all()}}\label{README.md_autotoc_md2637}
Specifies an {\ttfamily \$all} query condition


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('permission').all(['read',\ 'write'])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/all/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2638}{}\doxysubsubsection{\texorpdfstring{and()}{and()}}\label{README.md_autotoc_md2638}
Specifies arguments for an {\ttfamily \$and} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().and([\{\ color:\ 'green'\ \},\ \{\ status:\ 'ok'\ \}])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/and/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2639}{}\doxysubsubsection{\texorpdfstring{box()}{box()}}\label{README.md_autotoc_md2639}
Specifies a {\ttfamily \$box} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ lowerLeft\ =\ [40.73083,\ -\/73.99756]}
\DoxyCodeLine{var\ upperRight=\ [40.741404,\ \ -\/73.988135]}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().where('location').within().box(lowerLeft,\ upperRight)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/box/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2640}{}\doxysubsubsection{\texorpdfstring{circle()}{circle()}}\label{README.md_autotoc_md2640}
Specifies a {\ttfamily \$center} or {\ttfamily \$center\+Sphere} condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ area\ =\ \{\ center:\ [50,\ 50],\ radius:\ 10,\ unique:\ true\ \}}
\DoxyCodeLine{query.where('loc').within().circle(area)}
\DoxyCodeLine{query.circle('loc',\ area);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ for\ spherical\ calculations}
\DoxyCodeLine{var\ area\ =\ \{\ center:\ [50,\ 50],\ radius:\ 10,\ unique:\ true,\ spherical:\ true\ \}}
\DoxyCodeLine{query.where('loc').within().circle(area)}
\DoxyCodeLine{query.circle('loc',\ area);}

\end{DoxyCode}



\begin{DoxyItemize}
\item \href{http://docs.mongodb.org/manual/reference/operator/center/}{\texttt{ Mongo\+DB Documentation -\/ center}}
\item \href{http://docs.mongodb.org/manual/reference/operator/centerSphere/}{\texttt{ Mongo\+DB Documentation -\/ center\+Sphere}}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2641}{}\doxysubsubsection{\texorpdfstring{elem\+Match()}{elem\+Match()}}\label{README.md_autotoc_md2641}
Specifies an {\ttfamily \$elem\+Match} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{query.where('comment').elemMatch(\{\ author:\ 'autobot',\ votes:\ \{\$gte:\ 5\}\})}
\DoxyCodeLine{}
\DoxyCodeLine{query.elemMatch('comment',\ function\ (elem)\ \{}
\DoxyCodeLine{\ \ elem.where('author').equals('autobot');}
\DoxyCodeLine{\ \ elem.where('votes').gte(5);}
\DoxyCodeLine{\})}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/elemMatch/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2642}{}\doxysubsubsection{\texorpdfstring{equals()}{equals()}}\label{README.md_autotoc_md2642}
Specifies the complementary comparison value for the path specified with {\ttfamily where()}.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('age').equals(49);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ is\ the\ same\ as}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().where(\{\ 'age':\ 49\ \});}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2643}{}\doxysubsubsection{\texorpdfstring{exists()}{exists()}}\label{README.md_autotoc_md2643}
Specifies an {\ttfamily \$exists} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ \{\ name:\ \{\ \$exists:\ true\ \}\}}
\DoxyCodeLine{mquery().where('name').exists()}
\DoxyCodeLine{mquery().where('name').exists(true)}
\DoxyCodeLine{mquery().exists('name')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ \{\ name:\ \{\ \$exists:\ false\ \}\}}
\DoxyCodeLine{mquery().where('name').exists(false);}
\DoxyCodeLine{mquery().exists('name',\ false);}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/exists/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2644}{}\doxysubsubsection{\texorpdfstring{geometry()}{geometry()}}\label{README.md_autotoc_md2644}
Specifies a {\ttfamily \$geometry} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ polyA\ =\ [[[\ 10,\ 20\ ],\ [\ 10,\ 40\ ],\ [\ 30,\ 40\ ],\ [\ 30,\ 20\ ]]]}
\DoxyCodeLine{query.where('loc').within().geometry(\{\ type:\ 'Polygon',\ coordinates:\ polyA\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{var\ polyB\ =\ [[\ 0,\ 0\ ],\ [\ 1,\ 1\ ]]}
\DoxyCodeLine{query.where('loc').within().geometry(\{\ type:\ 'LineString',\ coordinates:\ polyB\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{var\ polyC\ =\ [\ 0,\ 0\ ]}
\DoxyCodeLine{query.where('loc').within().geometry(\{\ type:\ 'Point',\ coordinates:\ polyC\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{query.where('loc').intersects().geometry(\{\ type:\ 'Point',\ coordinates:\ polyC\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{query.where('loc').near().geometry(\{\ type:\ 'Point',\ coordinates:\ [3,5]\ \})}

\end{DoxyCode}


{\ttfamily geometry()} {\bfseries{must}} come after {\ttfamily intersects()}, {\ttfamily within()}, or {\ttfamily near()}.

The {\ttfamily object} argument must contain {\ttfamily type} and {\ttfamily coordinates} properties.


\begin{DoxyItemize}
\item type {\ttfamily String}
\item coordinates {\ttfamily Array}
\end{DoxyItemize}

\href{http://docs.mongodb.org/manual/reference/operator/geometry/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2645}{}\doxysubsubsection{\texorpdfstring{gt()}{gt()}}\label{README.md_autotoc_md2645}
Specifies a {\ttfamily \$gt} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('clicks').gt(999)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/gt/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2646}{}\doxysubsubsection{\texorpdfstring{gte()}{gte()}}\label{README.md_autotoc_md2646}
Specifies a {\ttfamily \$gte} query condition.

\href{http://docs.mongodb.org/manual/reference/operator/gte/}{\texttt{ Mongo\+DB Documentation}}


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('clicks').gte(1000)}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2647}{}\doxysubsubsection{\texorpdfstring{in()}{in()}}\label{README.md_autotoc_md2647}
Specifies an {\ttfamily \$in} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('author\_id').in([3,\ 48901,\ 761])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/in/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2648}{}\doxysubsubsection{\texorpdfstring{intersects()}{intersects()}}\label{README.md_autotoc_md2648}
Declares an {\ttfamily \$geo\+Intersects} query for {\ttfamily geometry()}.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.where('path').intersects().geometry(\{}
\DoxyCodeLine{\ \ \ \ type:\ 'LineString'}
\DoxyCodeLine{\ \ ,\ coordinates:\ [[180.0,\ 11.0],\ [180,\ 9.0]]}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ geometry\ arguments\ are\ supported}
\DoxyCodeLine{query.where('path').intersects(\{}
\DoxyCodeLine{\ \ \ \ type:\ 'LineString'}
\DoxyCodeLine{\ \ ,\ coordinates:\ [[180.0,\ 11.0],\ [180,\ 9.0]]}
\DoxyCodeLine{\})}

\end{DoxyCode}


{\bfseries{Must}} be used after {\ttfamily where()}.

\href{http://docs.mongodb.org/manual/reference/operator/geoIntersects/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2649}{}\doxysubsubsection{\texorpdfstring{lt()}{lt()}}\label{README.md_autotoc_md2649}
Specifies a {\ttfamily \$lt} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('clicks').lt(50)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/lt/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2650}{}\doxysubsubsection{\texorpdfstring{lte()}{lte()}}\label{README.md_autotoc_md2650}
Specifies a {\ttfamily \$lte} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('clicks').lte(49)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/lte/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2651}{}\doxysubsubsection{\texorpdfstring{max\+Distance()}{max\+Distance()}}\label{README.md_autotoc_md2651}
Specifies a {\ttfamily \$max\+Distance} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('location').near(\{\ center:\ [139,\ 74.3]\ \}).maxDistance(5)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/maxDistance/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2652}{}\doxysubsubsection{\texorpdfstring{mod()}{mod()}}\label{README.md_autotoc_md2652}
Specifies a {\ttfamily \$mod} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('count').mod(2,\ 0)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/mod/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2653}{}\doxysubsubsection{\texorpdfstring{ne()}{ne()}}\label{README.md_autotoc_md2653}
Specifies a {\ttfamily \$ne} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('status').ne('ok')}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/ne/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2654}{}\doxysubsubsection{\texorpdfstring{nin()}{nin()}}\label{README.md_autotoc_md2654}
Specifies an {\ttfamily \$nin} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('author\_id').nin([3,\ 48901,\ 761])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/nin/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2655}{}\doxysubsubsection{\texorpdfstring{nor()}{nor()}}\label{README.md_autotoc_md2655}
Specifies arguments for an {\ttfamily \$nor} condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().nor([\{\ color:\ 'green'\ \},\ \{\ status:\ 'ok'\ \}])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/nor/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2656}{}\doxysubsubsection{\texorpdfstring{near()}{near()}}\label{README.md_autotoc_md2656}
Specifies arguments for a {\ttfamily \$near} or {\ttfamily \$near\+Sphere} condition.

These operators return documents sorted by distance.\hypertarget{README.md_autotoc_md2657}{}\doxysubsubsubsection{\texorpdfstring{Example}{Example}}\label{README.md_autotoc_md2657}

\begin{DoxyCode}{0}
\DoxyCodeLine{query.where('loc').near(\{\ center:\ [10,\ 10]\ \});}
\DoxyCodeLine{query.where('loc').near(\{\ center:\ [10,\ 10],\ maxDistance:\ 5\ \});}
\DoxyCodeLine{query.near('loc',\ \{\ center:\ [10,\ 10],\ maxDistance:\ 5\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ GeoJSON}
\DoxyCodeLine{query.where('loc').near(\{\ center:\ \{\ type:\ 'Point',\ coordinates:\ [10,\ 10]\ \}\});}
\DoxyCodeLine{query.where('loc').near(\{\ center:\ \{\ type:\ 'Point',\ coordinates:\ [10,\ 10]\ \},\ maxDistance:\ 5,\ spherical:\ true\ \});}
\DoxyCodeLine{query.where('loc').near().geometry(\{\ type:\ 'Point',\ coordinates:\ [10,\ 10]\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ For\ a\ \$nearSphere\ condition,\ pass\ the\ \`{}spherical`\ option.}
\DoxyCodeLine{query.near(\{\ center:\ [10,\ 10],\ maxDistance:\ 5,\ spherical:\ true\ \});}

\end{DoxyCode}


\href{http://www.mongodb.org/display/DOCS/Geospatial+Indexing}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2658}{}\doxysubsubsection{\texorpdfstring{or()}{or()}}\label{README.md_autotoc_md2658}
Specifies arguments for an {\ttfamily \$or} condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().or([\{\ color:\ 'red'\ \},\ \{\ status:\ 'emergency'\ \}])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/or/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2659}{}\doxysubsubsection{\texorpdfstring{polygon()}{polygon()}}\label{README.md_autotoc_md2659}
Specifies a {\ttfamily \$polygon} condition


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('loc').within().polygon([10,20],\ [13,\ 25],\ [7,15])}
\DoxyCodeLine{mquery().polygon('loc',\ [10,20],\ [13,\ 25],\ [7,15])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/polygon/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2660}{}\doxysubsubsection{\texorpdfstring{regex()}{regex()}}\label{README.md_autotoc_md2660}
Specifies a {\ttfamily \$regex} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('name').regex(/\string^sixstepsrecords/)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/regex/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2661}{}\doxysubsubsection{\texorpdfstring{select()}{select()}}\label{README.md_autotoc_md2661}
Specifies which document fields to include or exclude


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ 1\ means\ include,\ 0\ means\ exclude}
\DoxyCodeLine{mquery().select(\{\ name:\ 1,\ address:\ 1,\ \_id:\ 0\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().select('name\ address\ -\/\_id')}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2662}{}\doxysubsubsubsection{\texorpdfstring{String syntax}{String syntax}}\label{README.md_autotoc_md2662}
When passing a string, prefixing a path with {\ttfamily -\/} will flag that path as excluded. When a path does not have the {\ttfamily -\/} prefix, it is included.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ include\ a\ and\ b,\ exclude\ c}
\DoxyCodeLine{query.select('a\ b\ -\/c');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or\ you\ may\ use\ object\ notation,\ useful\ when}
\DoxyCodeLine{//\ you\ have\ keys\ already\ prefixed\ with\ a\ "{}-\/"{}}
\DoxyCodeLine{query.select(\{a:\ 1,\ b:\ 1,\ c:\ 0\});}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}\hypertarget{README.md_autotoc_md2663}{}\doxysubsubsection{\texorpdfstring{selected()}{selected()}}\label{README.md_autotoc_md2663}
Determines if the query has selected any fields.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ query\ =\ mquery();}
\DoxyCodeLine{query.selected()\ //\ false}
\DoxyCodeLine{query.select('-\/name');}
\DoxyCodeLine{query.selected()\ //\ true}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2664}{}\doxysubsubsection{\texorpdfstring{selected\+Inclusively()}{selected\+Inclusively()}}\label{README.md_autotoc_md2664}
Determines if the query has selected any fields inclusively.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ query\ =\ mquery().select('name');}
\DoxyCodeLine{query.selectedInclusively()\ //\ true}
\DoxyCodeLine{}
\DoxyCodeLine{var\ query\ =\ mquery();}
\DoxyCodeLine{query.selected()\ //\ false}
\DoxyCodeLine{query.select('-\/name');}
\DoxyCodeLine{query.selectedInclusively()\ //\ false}
\DoxyCodeLine{query.selectedExclusively()\ //\ true}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2665}{}\doxysubsubsection{\texorpdfstring{selected\+Exclusively()}{selected\+Exclusively()}}\label{README.md_autotoc_md2665}
Determines if the query has selected any fields exclusively.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ query\ =\ mquery().select('-\/name');}
\DoxyCodeLine{query.selectedExclusively()\ //\ true}
\DoxyCodeLine{}
\DoxyCodeLine{var\ query\ =\ mquery();}
\DoxyCodeLine{query.selected()\ //\ false}
\DoxyCodeLine{query.select('name');}
\DoxyCodeLine{query.selectedExclusively()\ //\ false}
\DoxyCodeLine{query.selectedInclusively()\ //\ true}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2666}{}\doxysubsubsection{\texorpdfstring{size()}{size()}}\label{README.md_autotoc_md2666}
Specifies a {\ttfamily \$size} query condition.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('someArray').size(6)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/operator/size/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2667}{}\doxysubsubsection{\texorpdfstring{slice()}{slice()}}\label{README.md_autotoc_md2667}
Specifies a {\ttfamily \$slice} projection for a {\ttfamily path}


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().where('comments').slice(5)}
\DoxyCodeLine{mquery().where('comments').slice(-\/5)}
\DoxyCodeLine{mquery().where('comments').slice([-\/10,\ 5])}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/projection/slice/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2668}{}\doxysubsubsection{\texorpdfstring{within()}{within()}}\label{README.md_autotoc_md2668}
Sets a {\ttfamily \$geo\+Within} or {\ttfamily \$within} argument for geo-\/spatial queries.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().within().box()}
\DoxyCodeLine{mquery().within().circle()}
\DoxyCodeLine{mquery().within().geometry()}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().where('loc').within(\{\ center:\ [50,50],\ radius:\ 10,\ unique:\ true,\ spherical:\ true\ \});}
\DoxyCodeLine{mquery().where('loc').within(\{\ box:\ [[40.73,\ -\/73.9],\ [40.7,\ -\/73.988]]\ \});}
\DoxyCodeLine{mquery().where('loc').within(\{\ polygon:\ [[],[],[],[]]\ \});}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().where('loc').within([],\ [],\ [])\ //\ polygon}
\DoxyCodeLine{mquery().where('loc').within([],\ [])\ //\ box}
\DoxyCodeLine{mquery().where('loc').within(\{\ type:\ 'LineString',\ coordinates:\ [...]\ \});\ //\ geometry}

\end{DoxyCode}


As of mquery 2.\+0, {\ttfamily \$geo\+Within} is used by default. This impacts you if running Mongo\+DB \texorpdfstring{$<$}{<} 2.\+4. To alter this behavior, see mquery.use\$geo\+Within.

{\bfseries{Must}} be used after {\ttfamily where()}.

\href{http://docs.mongodb.org/manual/reference/operator/geoWithin/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2669}{}\doxysubsubsection{\texorpdfstring{where()}{where()}}\label{README.md_autotoc_md2669}
Specifies a {\ttfamily path} for use with chaining


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ instead\ of\ writing:}
\DoxyCodeLine{mquery().find(\{age:\ \{\$gte:\ 21,\ \$lte:\ 65\}\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ we\ can\ instead\ write:}
\DoxyCodeLine{mquery().where('age').gte(21).lte(65);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ passing\ query\ conditions\ is\ permitted\ too}
\DoxyCodeLine{mquery().find().where(\{\ name:\ 'vonderful'\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ chaining}
\DoxyCodeLine{await\ mquery()}
\DoxyCodeLine{\ \ .where('age').gte(21).lte(65)}
\DoxyCodeLine{\ \ .where(\{\ 'name':\ /\string^vonderful/i\ \})}
\DoxyCodeLine{\ \ .where('friends').slice(10)}
\DoxyCodeLine{\ \ .exec()}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2670}{}\doxysubsubsection{\texorpdfstring{\$where()}{\$where()}}\label{README.md_autotoc_md2670}
Specifies a {\ttfamily \$where} condition.

Use {\ttfamily \$where} when you need to select documents using a Java\+Script expression.


\begin{DoxyCode}{0}
\DoxyCodeLine{await\ query.\$where('this.comments.length\ >\ 10\ ||\ this.name.length\ >\ 5').exec()}
\DoxyCodeLine{}
\DoxyCodeLine{query.\$where(function\ ()\ \{}
\DoxyCodeLine{\ \ return\ this.comments.length\ >\ 10\ ||\ this.name.length\ >\ 5;}
\DoxyCodeLine{\})}

\end{DoxyCode}


Only use {\ttfamily \$where} when you have a condition that cannot be met using other Mongo\+DB operators like {\ttfamily \$lt}. Be sure to read about all of \href{http://docs.mongodb.org/manual/reference/operator/where/}{\texttt{ its caveats}} before using.

\DoxyHorRuler{0}
\hypertarget{README.md_autotoc_md2672}{}\doxysubsubsection{\texorpdfstring{batch\+Size()}{batch\+Size()}}\label{README.md_autotoc_md2672}
Specifies the batch\+Size option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.batchSize(100)}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/method/cursor.batchSize/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2673}{}\doxysubsubsection{\texorpdfstring{collation()}{collation()}}\label{README.md_autotoc_md2673}
Specifies the collation option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.collation(\{\ locale:\ "{}en\_US"{},\ strength:\ 1\ \})}

\end{DoxyCode}


\href{https://docs.mongodb.com/manual/reference/method/cursor.collation/\#cursor.collation}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2674}{}\doxysubsubsection{\texorpdfstring{comment()}{comment()}}\label{README.md_autotoc_md2674}
Specifies the comment option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.comment('login\ query');}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/operator/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2675}{}\doxysubsubsection{\texorpdfstring{hint()}{hint()}}\label{README.md_autotoc_md2675}
Sets query hints.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().hint(\{\ indexA:\ 1,\ indexB:\ -\/1\ \})}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/operator/hint/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2676}{}\doxysubsubsection{\texorpdfstring{j()}{j()}}\label{README.md_autotoc_md2676}
Requests acknowledgement that this operation has been persisted to Mongo\+DB\textquotesingle{}s on-\/disk journal.

This option is only valid for operations that write to the database\+:


\begin{DoxyItemize}
\item {\ttfamily delete\+One()}
\item {\ttfamily delete\+Many()}
\item {\ttfamily find\+One\+And\+Delete()}
\item {\ttfamily find\+One\+And\+Update()}
\item {\ttfamily update\+One()}
\item {\ttfamily update\+Many()}
\end{DoxyItemize}

Defaults to the {\ttfamily j} value if it is specified in write\+Concern


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().j(true);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2677}{}\doxysubsubsection{\texorpdfstring{limit()}{limit()}}\label{README.md_autotoc_md2677}
Specifies the limit option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.limit(20)}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/method/cursor.limit/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2678}{}\doxysubsubsection{\texorpdfstring{max\+Time()}{max\+Time()}}\label{README.md_autotoc_md2678}
Specifies the max\+Time\+MS option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.maxTime(100)}
\DoxyCodeLine{query.maxTimeMS(100)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/method/cursor.maxTimeMS/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2679}{}\doxysubsubsection{\texorpdfstring{skip()}{skip()}}\label{README.md_autotoc_md2679}
Specifies the skip option.


\begin{DoxyCode}{0}
\DoxyCodeLine{query.skip(100).limit(20)}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/method/cursor.skip/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2680}{}\doxysubsubsection{\texorpdfstring{sort()}{sort()}}\label{README.md_autotoc_md2680}
Sets the query sort order.

If an object is passed, key values allowed are {\ttfamily asc}, {\ttfamily desc}, {\ttfamily ascending}, {\ttfamily descending}, {\ttfamily 1}, and {\ttfamily -\/1}.

If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with {\ttfamily -\/} which will be treated as descending.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ these\ are\ equivalent}
\DoxyCodeLine{query.sort(\{\ field:\ 'asc',\ test:\ -\/1\ \});}
\DoxyCodeLine{query.sort('field\ -\/test');}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/reference/method/cursor.sort/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2681}{}\doxysubsubsection{\texorpdfstring{read()}{read()}}\label{README.md_autotoc_md2681}
Sets the read\+Preference option for the query.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().read('primary')}
\DoxyCodeLine{mquery().read('p')\ \ //\ same\ as\ primary}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().read('primaryPreferred')}
\DoxyCodeLine{mquery().read('pp')\ //\ same\ as\ primaryPreferred}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().read('secondary')}
\DoxyCodeLine{mquery().read('s')\ \ //\ same\ as\ secondary}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().read('secondaryPreferred')}
\DoxyCodeLine{mquery().read('sp')\ //\ same\ as\ secondaryPreferred}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().read('nearest')}
\DoxyCodeLine{mquery().read('n')\ \ //\ same\ as\ nearest}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().setReadPreference('primary')\ //\ alias\ of\ .read()}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2682}{}\doxysubsubsubsection{\texorpdfstring{Preferences\+:}{Preferences\+:}}\label{README.md_autotoc_md2682}

\begin{DoxyItemize}
\item {\ttfamily primary} -\/ (default) Read from primary only. Operations will produce an error if primary is unavailable. Cannot be combined with tags.
\item {\ttfamily secondary} -\/ Read from secondary if available, otherwise error.
\item {\ttfamily primary\+Preferred} -\/ Read from primary if available, otherwise a secondary.
\item {\ttfamily secondary\+Preferred} -\/ Read from a secondary if available, otherwise read from the primary.
\item {\ttfamily nearest} -\/ All operations read from among the nearest candidates, but unlike other modes, this option will include both the primary and all secondaries in the random selection.
\end{DoxyItemize}

Aliases


\begin{DoxyItemize}
\item {\ttfamily p} primary
\item {\ttfamily pp} primary\+Preferred
\item {\ttfamily s} secondary
\item {\ttfamily sp} secondary\+Preferred
\item {\ttfamily n} nearest
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2683}{}\doxysubsubsubsection{\texorpdfstring{Preference Tags\+:}{Preference Tags\+:}}\label{README.md_autotoc_md2683}
To keep the separation of concerns between {\ttfamily mquery} and your driver clean, {\ttfamily mquery\#read()} no longer handles specifying a second {\ttfamily tags} argument as of version 0.\+5. If you need to specify tags, pass any non-\/string argument as the first argument. {\ttfamily mquery} will pass this argument untouched to your collections methods later. For example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ example\ of\ specifying\ tags\ using\ the\ Node.js\ driver}
\DoxyCodeLine{var\ ReadPref\ =\ require('mongodb').ReadPreference;}
\DoxyCodeLine{var\ preference\ =\ new\ ReadPref('secondary',\ [\{\ dc:'sf',\ s:\ 1\ \},\{\ dc:'ma',\ s:\ 2\ \}]);}
\DoxyCodeLine{mquery(...).read(preference).exec();}

\end{DoxyCode}


Read more about how to use read preferences \href{http://docs.mongodb.org/manual/applications/replication/\#read-preference}{\texttt{ here}} and \href{http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html\#read-preferences}{\texttt{ here}}.\hypertarget{README.md_autotoc_md2684}{}\doxysubsubsection{\texorpdfstring{read\+Concern()}{read\+Concern()}}\label{README.md_autotoc_md2684}
Sets the read\+Concern option for the query.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ local}
\DoxyCodeLine{mquery().readConcern('local')}
\DoxyCodeLine{mquery().readConcern('l')}
\DoxyCodeLine{mquery().r('l')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ available}
\DoxyCodeLine{mquery().readConcern('available')}
\DoxyCodeLine{mquery().readConcern('a')}
\DoxyCodeLine{mquery().r('a')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ majority}
\DoxyCodeLine{mquery().readConcern('majority')}
\DoxyCodeLine{mquery().readConcern('m')}
\DoxyCodeLine{mquery().r('m')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ linearizable}
\DoxyCodeLine{mquery().readConcern('linearizable')}
\DoxyCodeLine{mquery().readConcern('lz')}
\DoxyCodeLine{mquery().r('lz')}
\DoxyCodeLine{}
\DoxyCodeLine{//\ snapshot}
\DoxyCodeLine{mquery().readConcern('snapshot')}
\DoxyCodeLine{mquery().readConcern('s')}
\DoxyCodeLine{mquery().r('s')}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2685}{}\doxysubsubsubsection{\texorpdfstring{Read Concern Level\+:}{Read Concern Level\+:}}\label{README.md_autotoc_md2685}

\begin{DoxyItemize}
\item {\ttfamily local} -\/ The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.\+e. may be rolled back). (Mongo\+DB 3.\+2+)
\item {\ttfamily available} -\/ The query returns from the instance with no guarantee guarantee that the data has been written to a majority of the replica set members (i.\+e. may be rolled back). (Mongo\+DB 3.\+6+)
\item {\ttfamily majority} -\/ The query returns the data that has been acknowledged by a majority of the replica set members. The documents returned by the read operation are durable, even in the event of failure. (Mongo\+DB 3.\+2+)
\item {\ttfamily linearizable} -\/ The query returns data that reflects all successful majority-\/acknowledged writes that completed prior to the start of the read operation. The query may wait for concurrently executing writes to propagate to a majority of replica set members before returning results. (Mongo\+DB 3.\+4+)
\item {\ttfamily snapshot} -\/ Only available for operations within multi-\/document transactions. Upon transaction commit with write concern "{}majority"{}, the transaction operations are guaranteed to have read from a snapshot of majority-\/committed data. (Mongo\+DB 4.\+0+)
\end{DoxyItemize}

Aliases


\begin{DoxyItemize}
\item {\ttfamily l} local
\item {\ttfamily a} available
\item {\ttfamily m} majority
\item {\ttfamily lz} linearizable
\item {\ttfamily s} snapshot
\end{DoxyItemize}

Read more about how to use read concern \href{https://docs.mongodb.com/manual/reference/read-concern/}{\texttt{ here}}.\hypertarget{README.md_autotoc_md2686}{}\doxysubsubsection{\texorpdfstring{write\+Concern()}{write\+Concern()}}\label{README.md_autotoc_md2686}
Sets the write\+Concern option for the query.

This option is only valid for operations that write to the database\+:


\begin{DoxyItemize}
\item {\ttfamily delete\+One()}
\item {\ttfamily delete\+Many()}
\item {\ttfamily find\+One\+And\+Delete()}
\item {\ttfamily find\+One\+And\+Update()}
\item {\ttfamily update\+One()}
\item {\ttfamily update\+Many()}
\end{DoxyItemize}


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().writeConcern(0)}
\DoxyCodeLine{mquery().writeConcern(1)}
\DoxyCodeLine{mquery().writeConcern(\{\ w:\ 1,\ j:\ true,\ wtimeout:\ 2000\ \})}
\DoxyCodeLine{mquery().writeConcern('majority')}
\DoxyCodeLine{mquery().writeConcern('m')\ //\ same\ as\ majority}
\DoxyCodeLine{mquery().writeConcern('tagSetName')\ //\ if\ the\ tag\ set\ is\ 'm',\ use\ .writeConcern(\{\ w:\ 'm'\ \})\ instead}
\DoxyCodeLine{mquery().w(1)\ //\ w\ is\ alias\ of\ writeConcern}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2687}{}\doxysubsubsubsection{\texorpdfstring{Write Concern\+:}{Write Concern\+:}}\label{README.md_autotoc_md2687}
write\+Concern(\{ w\+: {\ttfamily \texorpdfstring{$<$}{<}value\texorpdfstring{$>$}{>}}, j\+: {\ttfamily \texorpdfstring{$<$}{<}boolean\texorpdfstring{$>$}{>}}, wtimeout\+: {\ttfamily \texorpdfstring{$<$}{<}number\texorpdfstring{$>$}{>}} \}\`{})


\begin{DoxyItemize}
\item the w option to request acknowledgement that the write operation has propagated to a specified number of mongod instances or to mongod instances with specified tags
\item the j option to request acknowledgement that the write operation has been written to the journal
\item the wtimeout option to specify a time limit to prevent write operations from blocking indefinitely
\end{DoxyItemize}

Can be break down to use the following syntax\+:

mquery().w({\ttfamily \texorpdfstring{$<$}{<}value\texorpdfstring{$>$}{>}}).j({\ttfamily \texorpdfstring{$<$}{<}boolean\texorpdfstring{$>$}{>}}).wtimeout({\ttfamily \texorpdfstring{$<$}{<}number\texorpdfstring{$>$}{>}})

Read more about how to use write concern \href{https://docs.mongodb.com/manual/reference/write-concern/}{\texttt{ here}}\hypertarget{README.md_autotoc_md2688}{}\doxysubsubsection{\texorpdfstring{slave\+Ok()}{slave\+Ok()}}\label{README.md_autotoc_md2688}
Sets the slave\+Ok option. {\ttfamily true} allows reading from secondaries.

{\bfseries{deprecated}} use read() preferences instead if on mongodb \texorpdfstring{$>$}{>}= 2.\+2


\begin{DoxyCode}{0}
\DoxyCodeLine{query.slaveOk()\ //\ true}
\DoxyCodeLine{query.slaveOk(true)}
\DoxyCodeLine{query.slaveOk(false)}

\end{DoxyCode}


\href{http://docs.mongodb.org/manual/reference/method/rs.slaveOk/}{\texttt{ Mongo\+DB documentation}}\hypertarget{README.md_autotoc_md2689}{}\doxysubsubsection{\texorpdfstring{tailable()}{tailable()}}\label{README.md_autotoc_md2689}
Sets tailable option.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().tailable()\ <==\ true}
\DoxyCodeLine{mquery().tailable(true)}
\DoxyCodeLine{mquery().tailable(false)}

\end{DoxyCode}


{\itshape Cannot be used with {\ttfamily distinct()}.}

\href{http://docs.mongodb.org/manual/tutorial/create-tailable-cursor/}{\texttt{ Mongo\+DB Documentation}}\hypertarget{README.md_autotoc_md2690}{}\doxysubsubsection{\texorpdfstring{wtimeout()}{wtimeout()}}\label{README.md_autotoc_md2690}
Specifies a time limit, in milliseconds, for the write concern. If {\ttfamily w \texorpdfstring{$>$}{>} 1}, it is maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is {\ttfamily 0}, which means no timeout.

This option is only valid for operations that write to the database\+:


\begin{DoxyItemize}
\item {\ttfamily delete\+One()}
\item {\ttfamily delete\+Many()}
\item {\ttfamily find\+One\+And\+Delete()}
\item {\ttfamily find\+One\+And\+Update()}
\item {\ttfamily update\+One()}
\item {\ttfamily update\+Many()}
\end{DoxyItemize}

Defaults to {\ttfamily wtimeout} value if it is specified in write\+Concern


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().wtimeout(2000)}
\DoxyCodeLine{mquery().wTimeout(2000)}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2691}{}\doxysubsection{\texorpdfstring{Helpers}{Helpers}}\label{README.md_autotoc_md2691}
\hypertarget{README.md_autotoc_md2692}{}\doxysubsubsection{\texorpdfstring{collection()}{collection()}}\label{README.md_autotoc_md2692}
Sets the querys collection.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().collection(aCollection)}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2693}{}\doxysubsubsection{\texorpdfstring{then()}{then()}}\label{README.md_autotoc_md2693}
Executes the query and returns a promise which will be resolved with the query results or rejected if the query responds with an error.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().find(..).then(success,\ error);}

\end{DoxyCode}


This is very useful when combined with \href{https://github.com/visionmedia/co}{\texttt{ co}} or \href{https://github.com/koajs/koa}{\texttt{ koa}}, which automatically resolve promise-\/like objects for you.


\begin{DoxyCode}{0}
\DoxyCodeLine{co(function*()\{}
\DoxyCodeLine{\ \ var\ doc\ =\ yield\ mquery().findOne(\{\ \_id:\ 499\ \});}
\DoxyCodeLine{\ \ console.log(doc);\ //\ \{\ \_id:\ 499,\ name:\ 'amazing',\ ..\ \}}
\DoxyCodeLine{\})();}

\end{DoxyCode}


{\itshape NOTE}\+: The returned promise is a \href{https://github.com/petkaantonov/bluebird/}{\texttt{ bluebird}} promise but this is customizable. If you want to use your favorite promise library, simply set {\ttfamily mquery.\+Promise = Your\+Promise\+Constructor}. Your {\ttfamily Promise} must be \href{http://promisesaplus.com/}{\texttt{ promises A+}} compliant.\hypertarget{README.md_autotoc_md2694}{}\doxysubsubsection{\texorpdfstring{merge(object)}{merge(object)}}\label{README.md_autotoc_md2694}
Merges other mquery or match condition objects into this one. When an mquery instance is passed, its match conditions, field selection and options are merged.


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ drum\ =\ mquery(\{\ type:\ 'drum'\ \}).collection(instruments);}
\DoxyCodeLine{const\ redDrum\ =\ mquery(\{\ color:\ 'red'\ \}).merge(drum);}
\DoxyCodeLine{const\ n\ =\ await\ redDrum.count();}
\DoxyCodeLine{console.log('there\ are\ \%d\ red\ drums',\ n);}

\end{DoxyCode}


Internally uses {\ttfamily mquery.\+can\+Merge} to determine validity.\hypertarget{README.md_autotoc_md2695}{}\doxysubsubsection{\texorpdfstring{set\+Options(options)}{set\+Options(options)}}\label{README.md_autotoc_md2695}
Sets query options.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery().setOptions(\{\ collection:\ coll,\ limit:\ 20\ \})}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2696}{}\doxysubsubsubsection{\texorpdfstring{set\+Options() options}{set\+Options() options}}\label{README.md_autotoc_md2696}

\begin{DoxyItemize}
\item tailable \texorpdfstring{$\ast$}{*}
\item sort \texorpdfstring{$\ast$}{*}
\item limit \texorpdfstring{$\ast$}{*}
\item skip \texorpdfstring{$\ast$}{*}
\item max\+Time \texorpdfstring{$\ast$}{*}
\item batch\+Size \texorpdfstring{$\ast$}{*}
\item comment \texorpdfstring{$\ast$}{*}
\item hint \texorpdfstring{$\ast$}{*}
\item collection\+: the collection to query against
\end{DoxyItemize}

{\itshape \texorpdfstring{$\ast$}{*} denotes a query helper method is also available}\hypertarget{README.md_autotoc_md2697}{}\doxysubsubsection{\texorpdfstring{set\+Trace\+Function(func)}{set\+Trace\+Function(func)}}\label{README.md_autotoc_md2697}
Set a function to trace this query. Useful for profiling or logging.


\begin{DoxyCode}{0}
\DoxyCodeLine{function\ traceFunction\ (method,\ queryInfo,\ query)\ \{}
\DoxyCodeLine{\ \ console.log('starting\ '\ +\ method\ +\ '\ query');}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ return\ function\ (err,\ result,\ millis)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('finished\ '\ +\ method\ +\ '\ query\ in\ '\ +\ millis\ +\ 'ms');}
\DoxyCodeLine{\ \ \};}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{mquery().setTraceFunction(traceFunction).findOne(\{name:\ 'Joe'\},\ cb);}

\end{DoxyCode}


The trace function is passed (method, query\+Info, query)


\begin{DoxyItemize}
\item method is the name of the method being called (e.\+g. find\+One)
\item query\+Info contains information about the query\+:
\begin{DoxyItemize}
\item conditions\+: query conditions/criteria
\item options\+: options such as sort, fields, etc
\item doc\+: document being updated
\end{DoxyItemize}
\item query is the query object
\end{DoxyItemize}

The trace function should return a callback function which accepts\+:
\begin{DoxyItemize}
\item err\+: error, if any
\item result\+: result, if any
\item millis\+: time spent waiting for query result
\end{DoxyItemize}

NOTE\+: stream requests are not traced.\hypertarget{README.md_autotoc_md2698}{}\doxysubsubsection{\texorpdfstring{mquery.\+set\+Global\+Trace\+Function(func)}{mquery.\+set\+Global\+Trace\+Function(func)}}\label{README.md_autotoc_md2698}
Similar to {\ttfamily set\+Trace\+Function()} but automatically applied to all queries.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery.setTraceFunction(traceFunction);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2699}{}\doxysubsubsection{\texorpdfstring{mquery.\+can\+Merge(conditions)}{mquery.\+can\+Merge(conditions)}}\label{README.md_autotoc_md2699}
Determines if {\ttfamily conditions} can be merged using {\ttfamily mquery().merge()}.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ query\ =\ mquery(\{\ type:\ 'drum'\ \});}
\DoxyCodeLine{var\ okToMerge\ =\ mquery.canMerge(anObject)}
\DoxyCodeLine{if\ (okToMerge)\ \{}
\DoxyCodeLine{\ \ query.merge(anObject);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2700}{}\doxysubsection{\texorpdfstring{mquery.\+use\$geo\+Within}{mquery.\+use\$geo\+Within}}\label{README.md_autotoc_md2700}
Mongo\+DB 2.\+4 introduced the {\ttfamily \$geo\+Within} operator which replaces and is 100\% backward compatible with {\ttfamily \$within}. As of mquery 0.\+2, we default to using {\ttfamily \$geo\+Within} for all {\ttfamily within()} calls.

If you are running Mongo\+DB \texorpdfstring{$<$}{<} 2.\+4 this will be problematic. To force {\ttfamily mquery} to be backward compatible and always use {\ttfamily \$within}, set the {\ttfamily mquery.\+use\$geo\+Within} flag to {\ttfamily false}.


\begin{DoxyCode}{0}
\DoxyCodeLine{mquery.use\$geoWithin\ =\ false;}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2701}{}\doxysubsection{\texorpdfstring{Custom Base Queries}{Custom Base Queries}}\label{README.md_autotoc_md2701}
Often times we want custom base queries that encapsulate predefined criteria. With {\ttfamily mquery} this is easy. First create the query you want to reuse and call its {\ttfamily to\+Constructor()} method which returns a new subclass of {\ttfamily mquery} that retains all options and criteria of the original.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ greatMovies\ =\ mquery(movieCollection).where('rating').gte(4.5).toConstructor();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ use\ it!}
\DoxyCodeLine{const\ n\ =\ await\ greatMovies().count();}
\DoxyCodeLine{console.log('There\ are\ \%d\ great\ movies',\ n);}
\DoxyCodeLine{}
\DoxyCodeLine{const\ docs\ =\ await\ greatMovies().where(\{\ name:\ /\string^Life/\ \}).select('name').find();}
\DoxyCodeLine{console.log(docs);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2702}{}\doxysubsection{\texorpdfstring{Validation}{Validation}}\label{README.md_autotoc_md2702}
Method and options combinations are checked for validity at runtime to prevent creation of invalid query constructs. For example, a {\ttfamily distinct} query does not support specifying options like {\ttfamily hint} or field selection. In this case an error will be thrown so you can catch these mistakes in development.\hypertarget{README.md_autotoc_md2703}{}\doxysubsection{\texorpdfstring{Debug support}{Debug support}}\label{README.md_autotoc_md2703}
Debug mode is provided through the use of the \href{https://github.com/visionmedia/debug}{\texttt{ debug}} module. To enable\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{DEBUG=mquery\ node\ yourprogram.js}

\end{DoxyCode}


Read the debug module documentation for more details.\hypertarget{README.md_autotoc_md2704}{}\doxysubsection{\texorpdfstring{General compatibility}{General compatibility}}\label{README.md_autotoc_md2704}
\hypertarget{README.md_autotoc_md2705}{}\doxysubsubsection{\texorpdfstring{Object\+Ids}{Object\+Ids}}\label{README.md_autotoc_md2705}
{\ttfamily mquery} clones query arguments before passing them to a {\ttfamily collection} method for execution. This prevents accidental side-\/affects to the objects you pass. To clone {\ttfamily Object\+Ids} we need to make some assumptions.

First, to check if an object is an {\ttfamily Object\+Id}, we check its constructors name. If it matches either {\ttfamily Object\+Id} or {\ttfamily Object\+ID} we clone it.

To clone {\ttfamily Object\+Ids}, we call its optional {\ttfamily clone} method. If a {\ttfamily clone} method does not exist, we fall back to calling {\ttfamily new obj.\+constructor(obj.\+id)}. We assume, for compatibility with the Node.\+js driver, that the {\ttfamily Object\+Id} instance has a public {\ttfamily id} property and that when creating an {\ttfamily Object\+Id} instance we can pass that {\ttfamily id} as an argument.\hypertarget{README.md_autotoc_md2706}{}\doxysubsubsubsection{\texorpdfstring{Read Preferences}{Read Preferences}}\label{README.md_autotoc_md2706}
{\ttfamily mquery} supports specifying \href{https://www.mongodb.com/docs/manual/core/read-preference/}{\texttt{ Read Preferences}} to control from which Mongo\+DB node your query will read. The Read Preferences spec also support specifying tags. To pass tags, some drivers (Node.\+js driver) require passing a special constructor that handles both the read preference and its tags. If you need to specify tags, pass an instance of your drivers Read\+Preference constructor or roll your own. {\ttfamily mquery} will store whatever you provide and pass later to your collection during execution.\hypertarget{README.md_autotoc_md2707}{}\doxysubsection{\texorpdfstring{Future goals}{Future goals}}\label{README.md_autotoc_md2707}

\begin{DoxyItemize}
\item mongo shell compatibility
\item browser compatibility
\end{DoxyItemize}\hypertarget{README.md_autotoc_md2708}{}\doxysubsection{\texorpdfstring{Installation}{Installation}}\label{README.md_autotoc_md2708}

\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ mquery}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md2709}{}\doxysubsection{\texorpdfstring{License}{License}}\label{README.md_autotoc_md2709}
\href{https://github.com/aheckmann/mquery/blob/master/LICENSE}{\texttt{ MIT}} 